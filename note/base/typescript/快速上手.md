# 快速上手

## TypeScript的作用

JavaScript 自诞生起，就运行于浏览器端，最初只是用来处理一些简单的用户交互，如表单验证等操作，而不是每次都提交给服务端验证。所以它不需要设计的特别复杂，只进行了简单的类型定义。

随着浏览器性能的提升，能够满足更加复杂的交互和承载更多的业务需求，所以基于 JavaScript 开发的项目也就越来越复杂，而复杂的项目也就意味着更多的Bug:smile:。

JavaScript 作为弱类型的语言，是被解释执行的，缺少运行前的类型检查，只能在运行时检查并找到类型错误。对于中/大型项目，由类型引发的错误非常多，甚至可以说是线上 Bug 的“重灾区”，核心原因就是 js 作为弱类型语言，没有编译器的类型校验。

为了弥补 JavaScript 类型上缺失，TypeScript 诞生了:blush:！其[官网](https://www.typescriptlang.org/)中写的很明确：**TypeScript 的目标就是成为 JavaScript 的类型检查器**。你可以把它当做一门全新的语言看待，它定义了一套完整的类型系统，并在“编译期”进行类型检查，只不过它把 JavaScript 作为“编译期”的产物了。

![TypeScript编译过程](./images/ts编译过程.png)

## TypeScript的组成

个人从架构的角度，把 TypeScript 的分成了下面三个层级。

![TypeScript组成](./images/ts组成.png)

##### 语言层 

虽然 TypeScript 最终是被编译成 JavaScript 执行的，但它依然是一门全新的语言。从学习的角度来讲，存在着不小的成本。这里仅说明它有哪些特点，在后续的章节中，我们再详细深入讲解它的语法。

- 对比 Java 等强类型语言，它定义了一套完整的语法，包括变量声明、函数声明、类声明、接口声明、函数重载等。
- 它支持 JavaScript 的所有语法，所以被称为 JavaScript 的超集。也就是说，任何合法的JavaScript 代码，都是合法的 TypeScript 代码。

##### 编译器 & 工具链层： 

如果是单纯的定义语法，那 TypeScript 实际上是做不了什么的，所以必须要有与之配套的工具，才能把它实际使用起来。

- 编译器：作用是把 TypeScript 代码编译成 JavaScript 代码。
- 语言服务：提供类型推断、代码补全、代码导航、重构等功能。
- 工程配置：配置 TypeScript 项目的编译选项、输出目录、模块系统等。

##### 生态融合层

TypeScript不是用来取代JavaScript的，世界已经是 JavaScript 的了，TypeScript 必须兼容整个世界。

## 安装

我们可以通过npm安装TypeScript，并且应该作为开发依赖被安装，它的本质是“转译器”，在运行时并不存在。
  
```bash
npm install typescript --save-dev
```

“ typescript ”包，包含下面几个部分：

![ts包组成](./images/ts包组成.png)

##### 命令行执行工具

这是 tsc 时真正运行的部分。它们通常位于 bin/ 目录下：

* `tsc` : TypeScript编译器的终端入口, 运行 `npx tsc` 或 `tsc` 时实际调用的文件。
* `tsserver` : TypeScript语言服务进程。这是IDE(如VS Code)背后的英雄，基于LSP（语言服务协议）与编辑器通信。它负责提供** 语法高亮、代码补全、实时错误提示 **。

##### 标准库声明文件

这是TypeScript内置的类型库，是类型系统的基础。ts 必须知道 js 的内置对象长什么样。

- 作用：为js内置对象（如 Array, Promise, window, Document 等）提供类型声明，无需你手动定义就可以做类型检查。
- 分类：
    - 按js版本：`lib.es5.d.ts` (ES5)、 `lib.es2015.d.ts` （ES6）、 `lib.esnext.d.ts`（最新 ES 特性）；
    - 按运行环境分：`lib.dom.d.ts` （浏览器环境）、 `lib.node.d.ts` (Node.js环境)、 `lib.webworker.d.ts` （WebWorker）；
- 使用方式： ts会根据tsconfig.json中的target和lib配置自动加载对象的 `.d.ts` 文件。（比如 `target: ES6` 会自动加载 `lib.es6.d.ts` ）.

##### 编译器核心与 API

这是整个TypeScript包的核心，这是整个包的底层逻辑实现：

- **核心内容**：包含 TS 编译的全流程逻辑 —— 词法分析、语法分析、类型检查、AST 转换、代码发射（生成 JS），以及类型系统的所有核心逻辑（类型推断、类型收窄、类型兼容性判断等）。
- **无独立拆分**：TS 的编译器逻辑被打包成一个单文件（typescript.lib.js），tsc和tsserver都会加载这个文件

##### 语言服务

这一部分是编辑器智能提示、跳转、重构的真正源头。

- **实时分析**：当你在编辑器里打字时，tsserver 会增量解析你的代码，计算语法树（AST）。
- **通信协议**：它通过 LSP (Language Server Protocol) 的变体与编辑器通信。


## TypeScript与JavaScript生态集成

TypeScript设计之初就考虑了与现有JavaScript生态的无缝集成，这使得引入TypeScript的成本大大降低。

### 第三方模块的类型支持

#### 自带类型定义的模块

现代JavaScript库越来越多地自带TypeScript类型定义：

```typescript
// 直接安装使用，无需额外配置
import { useState } from 'react'
import { createRouter } from 'vue-router'
```

这些库在package.json中包含types或typings字段，TypeScript会自动识别。

#### @types类型声明包

对于不自带类型定义的库，DefinitelyTyped项目提供了社区维护的类型定义：

```bash
# 安装类型定义包
npm install --save-dev @types/lodash
npm install --save-dev @types/node
npm install --save-dev @types/jest
```

类型定义包的命名规则是`@types/包名`，安装后TypeScript会自动识别。

#### 查找类型声明的方式

1. **官方文档**：查看库的文档是否说明TypeScript支持
2. **TypeSearch**：访问 https://www.typescriptlang.org/dt/search 搜索
3. **npm搜索**：搜索`@types/包名`
4. **IDE提示**：VSCode会提示安装可用的类型包

### 常用框架的TypeScript集成

#### React

React从16.8版本开始完全支持TypeScript：

```bash
# 创建TypeScript版本的React应用
npx create-react-app my-app --template typescript

# 或使用Vite
npm create vite@latest my-app -- --template react-ts
```

```typescript
import { useState, FC } from 'react'

interface Props {
  title: string
  count?: number
}

const Counter: FC<Props> = ({ title, count = 0 }) => {
  const [value, setValue] = useState(count)

  return (
    <div>
      <h1>{title}</h1>
      <button onClick={() => setValue(v => v + 1)}>{value}</button>
    </div>
  )
}
```

#### Vue

Vue 3对TypeScript有原生支持：

```bash
# 创建TypeScript版本的Vue应用
npm create vue@latest my-app
# 选择TypeScript选项
```

```typescript
import { defineComponent, ref } from 'vue'

export default defineComponent({
  props: {
    title: String,
    count: { type: Number, default: 0 }
  },
  setup(props) {
    const value = ref(props.count)

    const increment = () => {
      value.value++
    }

    return { value, increment }
  }
})
```

#### Node.js

Node.js的类型定义需要单独安装：

```bash
npm install --save-dev @types/node
```

```typescript
import fs from 'fs'
import path from 'path'

const readFile = (filePath: string): Promise<string> => {
  return new Promise((resolve, reject) => {
    fs.readFile(filePath, 'utf-8', (err, data) => {
      if (err) reject(err)
      else resolve(data)
    })
  })
}
```

### 渐进式引入TypeScript

对于现有JavaScript项目，可以逐步引入TypeScript：

1. **启用allowJs**：允许编译JavaScript文件
2. **配置checkJs**：对JS文件进行类型检查
3. **添加.d.ts文件**：为现有JS代码添加类型定义
4. **逐步迁移**：将文件从.js重命名为.ts

```json
{
  "compilerOptions": {
    "allowJs": true,
    "checkJs": false,
    "outDir": "./dist",
    "target": "es2015",
    "module": "commonjs"
  },
  "include": ["src/**/*"]
}
```

## TypeScript处理非JavaScript资源

在实际开发中，TypeScript项目通常需要处理HTML、CSS、图片等非JavaScript资源。TypeScript本身不处理这些资源，但可以通过配置和工具链来实现。

### 模块声明方式

#### 使用.d.ts声明文件

为非JavaScript资源创建类型声明：

```typescript
// src/types/assets.d.ts
declare module '*.css' {
  const content: { [className: string]: string }
  export default content
}

declare module '*.scss' {
  const content: { [className: string]: string }
  export default content
}

declare module '*.less' {
  const content: { [className: string]: string }
  export default content
}

declare module '*.svg' {
  const content: React.FC<React.SVGProps<SVGSVGElement>>
  export default content
}

declare module '*.png' {
  const content: string
  export default content
}

declare module '*.jpg' {
  const content: string
  export default content
}

declare module '*.html' {
  const content: string
  export default content
}
```

#### 使用ambient module声明

在tsconfig.json中配置类型声明文件：

```json
{
  "compilerOptions": {
    "typeRoots": ["./node_modules/@types", "./src/types"]
  },
  "include": ["src/**/*"]
}
```

### 构建工具集成

#### Webpack配置

```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.scss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
      {
        test: /\.(png|jpg|jpeg|gif|svg)$/,
        type: 'asset/resource'
      },
      {
        test: /\.html$/,
        type: 'asset/source'
      }
    ]
  }
}
```

#### Vite配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  css: {
    modules: {
      localsConvention: 'camelCase'
    }
  },
  assetsInclude: ['**/*.html']
})
```

### CSS Modules类型支持

CSS Modules是React项目中常用的样式方案，TypeScript需要特殊配置：

```typescript
// src/types/css-modules.d.ts
declare module '*.module.css' {
  const classes: { [key: string]: string }
  export default classes
}

declare module '*.module.scss' {
  const classes: { [key: string]: string }
  export default classes
}
```

使用示例：

```typescript
import styles from './Button.module.css'

const Button = () => {
  return <button className={styles.primary}>Click me</button>
}
```

### 全局样式导入

对于全局样式文件，可以使用特殊的导入语法：

```typescript
// 直接导入，不使用导入的值
import './global.css'
import './theme.scss'

// 或使用require
require('./normalize.css')
```

 
 
 