# 快速上手

## TypeScript的作用

JavaScript自诞生起，就运行于浏览器端，最初只是用来处理一些简单的用户交互，如表单验证等操作，而不是每次都提交给服务端验证。所以它不需要设计的特别复杂，只进行了简单的类型定义。

随着浏览器性能的提升，能够满足更加复杂的交互和承载更多的业务需求，所以基于JavaScript开发的项目也就越来越负责，而复杂的项目也就意味着更多的Bug:smile:。

JavaScript作为弱类型的语言，是被解释执行的，缺少运行前的类型检查，只能在运行时检查并找到类型错误。对于中/大型项目，由类型引发的错误非常多，甚至可以说是线上Bug的”重灾区“，核心原因就是JS作为弱类型语言，没有编译器的类型校验。

为了弥补JavaScript类型上缺失，TypeScript诞生了！:blush:。其[官网](https://www.typescriptlang.org/)中写的很明确：**TypeScript的目标就是成为JavaScript的类型检查器**。你可以把它当做一门全新的语言看待，它定义了一套完整的类型系统，并在”编译期“进行类型检查，只不过它把JavaScript作为”编译期“的产物了。

![TypeScript编译过程](./images/TS编译过程.png)


## 安装

我们可以通过npm安装TypeScript，并且应该作为开发依赖被安装，它的本质是“转译器”，在运行时并不存在。

```bash
npm install typescript --save-dev
```

”typescript包“ 包含下面几个部分：
![TS包组成](./images/TS包组成.png)

##### 命令行执行工具

这是 tsc 时真正运行的部分。它们通常位于 bin/ 目录下：

* `tsc`: TypeScript编译器的终端入口, 运行`npx tsc`或`tsc`时实际调用的文件。
* `tsserver`: TypeScript语言服务进程。这是IDE(如VS Code)背后的英雄，基于LSP（语言服务协议）与编辑器通信。它负责提供** 语法高亮、代码补全、实时错误提示 **。

##### 标准库声明文件

这是TypeScript内置的类型库，是类型系统的基础。ts 必须知道 js 的内置对象长什么样。

- 作用：为js内置对象（如 Array, Promise, window, Document 等）提供类型声明，无需你手动定义就可以做类型检查。
- 分类：
    - 按js版本：`lib.es5.d.ts`(ES5)、`lib.es2015.d.ts`（ES6）、`lib.esnext.d.ts`（最新 ES 特性）；
    - 按运行环境分：`lib.dom.d.ts`（浏览器环境）、`lib.node.d.ts`(Node.js环境、)、`lib.webworker.d.ts`（WebWorker）；
- 使用方式： ts会根据tsconfig.json中的target和lib配置自动加载对象的`.d.ts`文件。（比如`target: ES6`会自动加载`lib.es6.d.ts`）.

##### 编译器核心与 API

这是整个TypeScript包的核心，这是整个包的底层逻辑实现：

- **核心内容**：包含 TS 编译的全流程逻辑 —— 词法分析、语法分析、类型检查、AST 转换、代码发射（生成 JS），以及类型系统的所有核心逻辑（类型推断、类型收窄、类型兼容性判断等）。
- **无独立拆分**：TS 的编译器逻辑被打包成一个单文件（typescript.lib.js），tsc和tsserver都会加载这个文件

##### 语言服务

这一部分是编辑器智能提示、跳转、重构的真正源头。

- **实时分析**：当你在编辑器里打字时，tsserver 会增量解析你的代码，计算语法树（AST）。
- **通信协议**：它通过 LSP (Language Server Protocol) 的变体与编辑器通信。

## TypeScript的组成部分

TypeScript由多个核心部分组成，每个部分都有其特定的作用：

### 类型系统

类型系统是TypeScript的核心，提供了丰富的类型定义和检查能力：

- 基础类型：string、number、boolean、null、undefined、symbol、bigint
- 对象类型：interface、type、class、enum
- 高级类型：泛型、联合类型、交叉类型、条件类型、映射类型
- 类型推断：自动推导变量和函数返回值的类型
- 类型守卫：运行时类型检查的编译时保障

类型系统在"类型系统"、"泛型"、"类型操作"等章节有详细说明。

### 编译配置文件

tsconfig.json是TypeScript项目的配置文件，主要功能包括：

- 指定编译文件范围（files、include、exclude）
- 配置编译选项（compilerOptions）
- 指定输出目录和模块系统
- 配置类型检查严格程度
- 配置JSX处理方式
- 配置路径映射等

详细配置说明见"tsconfig配置文件"章节。

### 声明文件

声明文件（.d.ts）用于为JavaScript代码提供类型信息：

- 为第三方库提供类型定义
- 为现有JavaScript项目添加类型支持
- 扩展全局类型定义
- 模块声明和命名空间声明

声明文件的编写和使用在"声明文件"章节有详细说明。

### 模块系统

TypeScript支持多种模块系统：

- ES Modules（推荐）：import/export语法
- CommonJS：require/module.exports
- AMD、UMD等历史模块系统

模块系统的详细说明见"模块系统"章节。

### 编译器（tsc）

TypeScript编译器负责将TypeScript代码转换为JavaScript：

- 类型检查和错误报告
- 代码转换和降级（target配置）
- Source Map生成，支持源码调试
- 增量编译，提升编译速度

编译器命令行工具的使用见"tsc命令行工具"章节。

### 装饰器

装饰器提供了一种声明式的方式来修改类、方法、属性等：

- 类装饰器
- 方法装饰器
- 属性装饰器
- 参数装饰器

装饰器的使用见"装饰器"章节。


## TypeScript与JavaScript生态集成

TypeScript设计之初就考虑了与现有JavaScript生态的无缝集成，这使得引入TypeScript的成本大大降低。

### 第三方模块的类型支持

#### 自带类型定义的模块

现代JavaScript库越来越多地自带TypeScript类型定义：

```typescript
// 直接安装使用，无需额外配置
import { useState } from 'react'
import { createRouter } from 'vue-router'
```

这些库在package.json中包含types或typings字段，TypeScript会自动识别。

#### @types类型声明包

对于不自带类型定义的库，DefinitelyTyped项目提供了社区维护的类型定义：

```bash
# 安装类型定义包
npm install --save-dev @types/lodash
npm install --save-dev @types/node
npm install --save-dev @types/jest
```

类型定义包的命名规则是`@types/包名`，安装后TypeScript会自动识别。

#### 查找类型声明的方式

1. **官方文档**：查看库的文档是否说明TypeScript支持
2. **TypeSearch**：访问 https://www.typescriptlang.org/dt/search 搜索
3. **npm搜索**：搜索`@types/包名`
4. **IDE提示**：VSCode会提示安装可用的类型包

### 常用框架的TypeScript集成

#### React

React从16.8版本开始完全支持TypeScript：

```bash
# 创建TypeScript版本的React应用
npx create-react-app my-app --template typescript

# 或使用Vite
npm create vite@latest my-app -- --template react-ts
```

```typescript
import { useState, FC } from 'react'

interface Props {
  title: string
  count?: number
}

const Counter: FC<Props> = ({ title, count = 0 }) => {
  const [value, setValue] = useState(count)

  return (
    <div>
      <h1>{title}</h1>
      <button onClick={() => setValue(v => v + 1)}>{value}</button>
    </div>
  )
}
```

#### Vue

Vue 3对TypeScript有原生支持：

```bash
# 创建TypeScript版本的Vue应用
npm create vue@latest my-app
# 选择TypeScript选项
```

```typescript
import { defineComponent, ref } from 'vue'

export default defineComponent({
  props: {
    title: String,
    count: { type: Number, default: 0 }
  },
  setup(props) {
    const value = ref(props.count)

    const increment = () => {
      value.value++
    }

    return { value, increment }
  }
})
```

#### Node.js

Node.js的类型定义需要单独安装：

```bash
npm install --save-dev @types/node
```

```typescript
import fs from 'fs'
import path from 'path'

const readFile = (filePath: string): Promise<string> => {
  return new Promise((resolve, reject) => {
    fs.readFile(filePath, 'utf-8', (err, data) => {
      if (err) reject(err)
      else resolve(data)
    })
  })
}
```

### 渐进式引入TypeScript

对于现有JavaScript项目，可以逐步引入TypeScript：

1. **启用allowJs**：允许编译JavaScript文件
2. **配置checkJs**：对JS文件进行类型检查
3. **添加.d.ts文件**：为现有JS代码添加类型定义
4. **逐步迁移**：将文件从.js重命名为.ts

```json
{
  "compilerOptions": {
    "allowJs": true,
    "checkJs": false,
    "outDir": "./dist",
    "target": "es2015",
    "module": "commonjs"
  },
  "include": ["src/**/*"]
}
```

## TypeScript处理非JavaScript资源

在实际开发中，TypeScript项目通常需要处理HTML、CSS、图片等非JavaScript资源。TypeScript本身不处理这些资源，但可以通过配置和工具链来实现。

### 模块声明方式

#### 使用.d.ts声明文件

为非JavaScript资源创建类型声明：

```typescript
// src/types/assets.d.ts
declare module '*.css' {
  const content: { [className: string]: string }
  export default content
}

declare module '*.scss' {
  const content: { [className: string]: string }
  export default content
}

declare module '*.less' {
  const content: { [className: string]: string }
  export default content
}

declare module '*.svg' {
  const content: React.FC<React.SVGProps<SVGSVGElement>>
  export default content
}

declare module '*.png' {
  const content: string
  export default content
}

declare module '*.jpg' {
  const content: string
  export default content
}

declare module '*.html' {
  const content: string
  export default content
}
```

#### 使用ambient module声明

在tsconfig.json中配置类型声明文件：

```json
{
  "compilerOptions": {
    "typeRoots": ["./node_modules/@types", "./src/types"]
  },
  "include": ["src/**/*"]
}
```

### 构建工具集成

#### Webpack配置

```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.scss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
      {
        test: /\.(png|jpg|jpeg|gif|svg)$/,
        type: 'asset/resource'
      },
      {
        test: /\.html$/,
        type: 'asset/source'
      }
    ]
  }
}
```

#### Vite配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  css: {
    modules: {
      localsConvention: 'camelCase'
    }
  },
  assetsInclude: ['**/*.html']
})
```

### CSS Modules类型支持

CSS Modules是React项目中常用的样式方案，TypeScript需要特殊配置：

```typescript
// src/types/css-modules.d.ts
declare module '*.module.css' {
  const classes: { [key: string]: string }
  export default classes
}

declare module '*.module.scss' {
  const classes: { [key: string]: string }
  export default classes
}
```

使用示例：

```typescript
import styles from './Button.module.css'

const Button = () => {
  return <button className={styles.primary}>Click me</button>
}
```

### 全局样式导入

对于全局样式文件，可以使用特殊的导入语法：

```typescript
// 直接导入，不使用导入的值
import './global.css'
import './theme.scss'

// 或使用require
require('./normalize.css')
```

### SVG组件化

在React项目中，可以将SVG作为组件导入：

```typescript
// vite-plugin-svgr 或 @svgr/webpack 配置后
import Logo from './logo.svg'

const Header = () => {
  return <Logo width={100} height={50} />
}
```
 
 